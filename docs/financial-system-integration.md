# ุชูุฑูุฑ ุงูุชูุงูู ุงููุงูู - ุงูุฃูุธูุฉ ุงููุงููุฉ ูู Decision OS

## ุงูุชุงุฑูุฎ: 2026-01-01
## ุงูุญุงูุฉ: โ ููุชูู ููุชูุงูู ุจุงููุงูู

---

## ูุธุฑุฉ ุนุงูุฉ

ุฌููุน ุงูุฃูุธูุฉ ุงููุงููุฉ ูู Decision OS ูุฑุจูุทุฉ ุจุจุนุถูุง ุจุดูู ูุงูู ููุชูุงูู:

### ุงูุฃูุธูุฉ ุงูุฃุณุงุณูุฉ:
1. **ุงูุญุณุงุจุงุช ุงููุงููุฉ (Accounts)** - ุงูุฃุณุงุณ
2. **ุงููุตุงุฑูู (Expenses)** - ูุฑุชุจุท ุจุงูุญุณุงุจุงุช
3. **ุงูุฏุฎู (Incomes)** - ูุฑุชุจุท ุจุงูุญุณุงุจุงุช
4. **ุงูุฏููู ูุงููุฑูุถ (Debts & Loans)** - ูุฑุชุจุท ุจุงูุญุณุงุจุงุช

---

## ุฎุฑูุทุฉ ุงูุชูุงูู ุงููุงููุฉ

```
User (ุงููุณุชุฎุฏู)
โโโ Accounts (ุงูุญุณุงุจุงุช ุงููุงููุฉ)
โ   โโโ Expenses (ุงููุตุงุฑูู)
โ   โโโ Incomes (ุงูุฏุฎู)
โ   โโโ Debts (ุงูุฏููู)
โ   โโโ DebtPayments (ุฏูุนุงุช ุงูุฏููู)
โ
โโโ Expenses (ุงููุตุงุฑูู)
โ   โโโ โ Account (ุงูุญุณุงุจ ุงููุฑุชุจุท)
โ   โโโ โ ExpenseCategory (ุงููุฆุฉ)
โ
โโโ Incomes (ุงูุฏุฎู)
โ   โโโ โ Account (ุงูุญุณุงุจ ุงููุฑุชุจุท)
โ
โโโ Debts (ุงูุฏููู)
    โโโ โ Account (ุงูุญุณุงุจ ุงููุฑุชุจุท)
    โโโ DebtPayments (ุฌุฏูู ุงูุฏูุนุงุช)
        โโโ โ Account (ุงูุญุณุงุจ ุงููุณุชุฎุฏู ููุฏูุน)
```

---

## ุงูุชูุงุตูู ุงูุชูููุฉ

### 1. Account Model - ุงููุฑูุฒ ุงููุงูู

**ุงูุนูุงูุงุช (Relations):**
```php
// One-to-Many relationships
public function expenses()      // ุฌููุน ุงููุตุงุฑูู ูู ูุฐุง ุงูุญุณุงุจ
public function incomes()       // ุฌููุน ุงูุฏุฎู ููุฐุง ุงูุญุณุงุจ
public function debts()         // ุฌููุน ุงูุฏููู ุงููุฑุชุจุทุฉ ุจูุฐุง ุงูุญุณุงุจ
public function debtPayments()  // ุฌููุน ุฏูุนุงุช ุงูุฏููู ุนุจุฑ ูุฐุง ุงูุญุณุงุจ
```

**ุงูุญุณุงุจุงุช ุงูุชููุงุฆูุฉ:**
```php
public function getTotalExpensesAttribute()      // ุฅุฌูุงูู ุงููุตุงุฑูู
public function getTotalIncomesAttribute()       // ุฅุฌูุงูู ุงูุฏุฎู
public function getCalculatedBalanceAttribute()  // ุงูุฑุตูุฏ ุงููุญุณูุจ
```

**ุงูุชุญุฏูุซ ุงูุชููุงุฆู ููุฑุตูุฏ:**
```php
public function updateBalance($amount, $type = 'expense')
{
    if ($type === 'expense') {
        $this->balance -= $amount;  // ุทุฑุญ ุนูุฏ ุงููุตุฑูู
    } else {
        $this->balance += $amount;  // ุฅุถุงูุฉ ุนูุฏ ุงูุฏุฎู
    }
    $this->save();
}
```

---

### 2. Expense Model - ุงููุตุงุฑูู

**ุงูุนูุงูุงุช:**
```php
public function user()          // ุงููุณุชุฎุฏู
public function account()       // ุงูุญุณุงุจ ุงููุฑุชุจุท
public function category()      // ูุฆุฉ ุงููุตุฑูู
```

**ุงูุญููู:**
- `account_id` - ุงูุญุณุงุจ ุงููุงูู (nullable)
- `amount` - ุงููุจูุบ
- `date` - ุงูุชุงุฑูุฎ
- `expense_category_id` - ุงููุฆุฉ

**ุงูุชุญุฏูุซ ุงูุชููุงุฆู ุนูุฏ ุงูุฅุถุงูุฉ:**
```php
// ูู ExpenseController@store
if ($expense->account_id) {
    $expense->account->updateBalance($expense->amount, 'expense');
}
```

**ุงูุชุญุฏูุซ ุงูุชููุงุฆู ุนูุฏ ุงูุญุฐู:**
```php
// ูู ExpenseController@destroy
if ($expense->account_id) {
    // ุฅุนุงุฏุฉ ุงููุจูุบ ููุญุณุงุจ (ุนูุณ ุงูุนูููุฉ)
    $expense->account->updateBalance($expense->amount, 'income');
}
```

---

### 3. Income Model - ุงูุฏุฎู

**ุงูุนูุงูุงุช:**
```php
public function user()          // ุงููุณุชุฎุฏู
public function account()       // ุงูุญุณุงุจ ุงููุฑุชุจุท
```

**ุงูุญููู:**
- `account_id` - ุงูุญุณุงุจ ุงููุงูู (nullable)
- `amount` - ุงููุจูุบ
- `date` - ุงูุชุงุฑูุฎ
- `source` - ุงููุตุฏุฑ

**ุงูุชุญุฏูุซ ุงูุชููุงุฆู ุนูุฏ ุงูุฅุถุงูุฉ:**
```php
// ูู IncomeController@store
if ($income->account_id) {
    $income->account->updateBalance($income->amount, 'income');
}
```

**ุงูุชุญุฏูุซ ุงูุชููุงุฆู ุนูุฏ ุงูุญุฐู:**
```php
// ูู IncomeController@destroy
if ($income->account_id) {
    // ุฅุนุงุฏุฉ ุงููุจูุบ ูู ุงูุญุณุงุจ (ุนูุณ ุงูุนูููุฉ)
    $income->account->updateBalance($income->amount, 'expense');
}
```

---

### 4. Debt Model - ุงูุฏููู

**ุงูุนูุงูุงุช:**
```php
public function user()          // ุงููุณุชุฎุฏู
public function account()       // ุงูุญุณุงุจ ุงููุฑุชุจุท
public function payments()      // ุฏูุนุงุช ูุฐุง ุงูุฏูู
```

**ุงูุฃููุงุน:**
- `payable` - ุฏูู ุนูู (ุฃุฏูุนู ููุขุฎุฑูู)
- `receivable` - ุฏูู ูู (ูุณุชุญู ูู ุงูุขุฎุฑูู)

**ุงูุญููู:**
- `account_id` - ุงูุญุณุงุจ ุงููุงูู (nullable)
- `type` - ููุน ุงูุฏูู
- `total_amount` - ุงููุจูุบ ุงูููู
- `paid_amount` - ุงููุฏููุน
- `remaining_amount` - ุงููุชุจูู

**ุงูุชุญุฏูุซ ุงูุชููุงุฆู ููุญุงูุฉ:**
```php
public function updateStatus()
{
    // ุญุณุงุจ ุงููุจูุบ ุงููุฏููุน ูู ุฌููุน ุงูุฏูุนุงุช
    $this->paid_amount = $this->payments()
        ->where('status', 'paid')
        ->sum('amount');
    
    // ุญุณุงุจ ุงููุชุจูู
    $this->remaining_amount = $this->total_amount - $this->paid_amount;
    
    // ุชุญุฏูุฏ ุงูุญุงูุฉ
    if ($this->remaining_amount <= 0) {
        $this->status = 'fully_paid';
    } elseif ($this->paid_amount > 0) {
        $this->status = 'partially_paid';
    } elseif ($this->isOverdue()) {
        $this->status = 'overdue';
    } else {
        $this->status = 'active';
    }
}
```

---

### 5. DebtPayment Model - ุฏูุนุงุช ุงูุฏููู

**ุงูุนูุงูุงุช:**
```php
public function debt()          // ุงูุฏูู ุงูุฃุตูู
public function account()       // ุงูุญุณุงุจ ุงููุณุชุฎุฏู ููุฏูุน
```

**ุงูุญููู:**
- `debt_id` - ุงูุฏูู
- `account_id` - ุงูุญุณุงุจ (nullable)
- `amount` - ูุจูุบ ุงูุฏูุนุฉ
- `payment_date` - ุชุงุฑูุฎ ุงูุฏูุน
- `due_date` - ุชุงุฑูุฎ ุงูุงุณุชุญูุงู
- `status` - ุงูุญุงูุฉ

**ุงูุชุญุฏูุซ ุงูุชููุงุฆู ููุญุณุงุจ ุนูุฏ ุงูุฏูุน:**
```php
public function markAsPaid(?int $accountId = null)
{
    $this->status = 'paid';
    $this->payment_date = now();
    
    if ($accountId && $account = Account::find($accountId)) {
        // ุฅุฐุง ูุงู ุงูุฏูู ุนูู โ ุฃุทุฑุญ ูู ุงูุญุณุงุจ
        // ุฅุฐุง ูุงู ุงูุฏูู ูู โ ุฃุถูู ููุญุณุงุจ
        $type = $this->debt->type === 'payable' ? 'expense' : 'income';
        $account->updateBalance($this->amount, $type);
    }
    
    $this->save();
    $this->debt->updateStatus(); // ุชุญุฏูุซ ุญุงูุฉ ุงูุฏูู ุชููุงุฆูุงู
}
```

**Events ุงูุชููุงุฆูุฉ:**
```php
protected static function booted()
{
    static::created(function ($payment) {
        if ($payment->status === 'paid') {
            $payment->debt->updateStatus();
        }
    });
    
    static::updated(function ($payment) {
        if ($payment->isDirty('status') || $payment->isDirty('amount')) {
            $payment->debt->updateStatus();
        }
    });
    
    static::deleted(function ($payment) {
        $payment->debt->updateStatus();
    });
}
```

---

### 6. User Model - ุงููุณุชุฎุฏู

**ุงูุนูุงูุงุช ุงููุงููุฉ:**
```php
public function accounts()          // ุฌููุน ุงูุญุณุงุจุงุช ุงููุงููุฉ
public function debts()             // ุฌููุน ุงูุฏููู
public function payableDebts()      // ุงูุฏููู ุนูู
public function receivableDebts()   // ุงูุฏููู ูู
```

**ุงูุญุณุงุจุงุช ุงููุงููุฉ:**
```php
public function getCashOnHandAttribute()
{
    $totalIncome = Income::where('user_id', $this->id)->sum('amount');
    $totalExpenses = Expense::where('user_id', $this->id)->sum('amount');
    
    return $this->starting_balance + $totalIncome - $totalExpenses;
}
```

---

## ุณููุงุฑูููุงุช ุงูุชูุงูู ุงูุนูููุฉ

### ุณููุงุฑูู 1: ุฅุถุงูุฉ ูุตุฑูู ูุฑุจูุท ุจุญุณุงุจ

```
1. ุงููุณุชุฎุฏู ูุถูู ูุตุฑูู ุจูุจูุบ 100 AED
2. ูุฎุชุงุฑ ุงูุญุณุงุจ "ูุญูุธุฉ ููุฏูุฉ"
3. ุงููุธุงู:
   โ ููุดุฆ ุณุฌู Expense
   โ ูุฑุจุทู ุจุงูุญุณุงุจ (account_id)
   โ ูุฎุตู 100 AED ูู ุฑุตูุฏ ุงูุญุณุงุจ ุชููุงุฆูุงู
   โ ูุญุฏุซ ุฑุตูุฏ ุงูุญุณุงุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```

### ุณููุงุฑูู 2: ุญุฐู ูุตุฑูู

```
1. ุงููุณุชุฎุฏู ูุญุฐู ูุตุฑูู ุจูุจูุบ 100 AED
2. ุงููุตุฑูู ูุงู ูุฑุจูุท ุจุญุณุงุจ "ูุญูุธุฉ ููุฏูุฉ"
3. ุงููุธุงู:
   โ ูุนูุฏ 100 AED ุฅูู ุฑุตูุฏ ุงูุญุณุงุจ
   โ ูุญุฐู ุณุฌู Expense
   โ ุงูุฑุตูุฏ ูุนูุฏ ููุง ูุงู ูุจู ุงููุตุฑูู
```

### ุณููุงุฑูู 3: ุฅุถุงูุฉ ุฏุฎู ูุฑุจูุท ุจุญุณุงุจ

```
1. ุงููุณุชุฎุฏู ูุถูู ุฏุฎู ุจูุจูุบ 5000 AED
2. ูุฎุชุงุฑ ุงูุญุณุงุจ "ุจูู ุงูุฅูุงุฑุงุช"
3. ุงููุธุงู:
   โ ููุดุฆ ุณุฌู Income
   โ ูุฑุจุทู ุจุงูุญุณุงุจ (account_id)
   โ ูุถูู 5000 AED ุฅูู ุฑุตูุฏ ุงูุญุณุงุจ ุชููุงุฆูุงู
   โ ูุญุฏุซ ุฑุตูุฏ ุงูุญุณุงุจ
```

### ุณููุงุฑูู 4: ุฏูู ุฌุฏูุฏ ุจุฌุฏูู ุฃูุณุงุท

```
1. ุงููุณุชุฎุฏู ูุถูู ุฏูู "ุนูู" ุจูุจูุบ 10,000 AED
2. ูุฎุชุงุฑ ุชูุฑุงุฑ "ุดูุฑู" ุจู 10 ุฃูุณุงุท
3. ูุฑุจุทู ุจุญุณุงุจ "ุจูู ุงูุฅูุงุฑุงุช"
4. ุงููุธุงู:
   โ ููุดุฆ ุณุฌู Debt
   โ ูููุฏ 10 ุฏูุนุงุช ูู ุฌุฏูู DebtPayments
   โ ูุญุณุจ ุชูุงุฑูุฎ ุงูุงุณุชุญูุงู ุชููุงุฆูุงู
   โ ูุฑุจุท ุงูุฏูู ุจุงูุญุณุงุจ
```

### ุณููุงุฑูู 5: ุชุณุฌูู ุฏูุนุฉ ุฏูู

```
1. ุงููุณุชุฎุฏู ูุฏูู ุฏูู "ุนูู" ุจูุณุท ุดูุฑู 1000 AED
2. ูุณุฌู ุฏูุนุฉ ุจุงุฎุชูุงุฑ ุญุณุงุจ "ุจูู ุงูุฅูุงุฑุงุช"
3. ุงููุธุงู:
   โ ูุญุฏุซ ุญุงูุฉ ุงูุฏูุนุฉ ุฅูู "paid"
   โ ูุฎุตู 1000 AED ูู ุญุณุงุจ "ุจูู ุงูุฅูุงุฑุงุช"
   โ ูุญุฏุซ paid_amount ูู ุงูุฏูู
   โ ูุญุฏุซ remaining_amount
   โ ูุญุฏุซ ุญุงูุฉ ุงูุฏูู (partially_paid)
```

### ุณููุงุฑูู 6: ุงุณุชูุงู ุฏูุนุฉ ุฏูู "ูู"

```
1. ุงููุณุชุฎุฏู ูุฏูู ุฏูู "ูู" (ูุณุชุญู ูู) ุจูููุฉ 5000 AED
2. ูุณุชูู ุฏูุนุฉ 2000 AED
3. ูุณุฌููุง ุนูู ุญุณุงุจ "ูุญูุธุฉ ููุฏูุฉ"
4. ุงููุธุงู:
   โ ูุญุฏุซ ุญุงูุฉ ุงูุฏูุนุฉ ุฅูู "paid"
   โ ูุถูู 2000 AED ุฅูู "ูุญูุธุฉ ููุฏูุฉ"
   โ ูุญุฏุซ paid_amount ูู ุงูุฏูู (2000)
   โ ูุญุฏุซ remaining_amount (3000)
   โ ูุญุฏุซ ุญุงูุฉ ุงูุฏูู (partially_paid)
```

---

## ุงูุชุญูู ูู ุณูุงูุฉ ุงูุจูุงูุงุช

### ููุงุนุฏ ุงูุชุญูู ุงูุชููุงุฆู:

1. **ุนูุฏ ุฅุถุงูุฉ ูุตุฑูู:**
   - ูุฌุจ ุฃู ูููู account_id ููุฌูุฏ ูู ุฌุฏูู accounts (ุฃู null)
   - ูุชู ุฎุตู ุงููุจูุบ ููุฑุงู ูู ุงูุญุณุงุจ

2. **ุนูุฏ ุญุฐู ูุตุฑูู:**
   - ุฅุฐุง ูุงู ูุฑุจูุท ุจุญุณุงุจุ ูุชู ุฅุฑุฌุงุน ุงููุจูุบ
   - ูููุน ุญุฐู ุงูุจูุงูุงุช ุงููุงููุฉ ุจุนุฏ ูุชุฑุฉ (ูููู ุฅุถุงูุฉ ูุฐุง ูุงุญูุงู)

3. **ุนูุฏ ุฅุถุงูุฉ ุฏุฎู:**
   - ูุฌุจ ุฃู ูููู account_id ููุฌูุฏ ูู ุฌุฏูู accounts (ุฃู null)
   - ูุชู ุฅุถุงูุฉ ุงููุจูุบ ููุฑุงู ููุญุณุงุจ

4. **ุนูุฏ ุญุฐู ุฏุฎู:**
   - ุฅุฐุง ูุงู ูุฑุจูุท ุจุญุณุงุจุ ูุชู ุฎุตู ุงููุจูุบ
   
5. **ุนูุฏ ุฅุถุงูุฉ ุฏูู:**
   - ูุฌุจ ุชุญุฏูุฏ ููุน ุงูุฏูู (payable/receivable)
   - ูุชู ุชูููุฏ ุฌุฏูู ุงูุฏูุนุงุช ุชููุงุฆูุงู
   - remaining_amount = total_amount ุนูุฏ ุงูุฅูุดุงุก

6. **ุนูุฏ ุชุณุฌูู ุฏูุนุฉ ุฏูู:**
   - ูุชู ุชุญุฏูุซ ุฑุตูุฏ ุงูุญุณุงุจ ุญุณุจ ููุน ุงูุฏูู
   - ูุชู ุชุญุฏูุซ ุญุงูุฉ ุงูุฏูู ุชููุงุฆูุงู
   - ุฅุฐุง paid_amount >= total_amount โ fully_paid

---

## ุงูุฅุญุตุงุฆูุงุช ุงููุชุงุญุฉ

### ูู Account Model:
```php
$account->total_expenses        // ุฅุฌูุงูู ุงููุตุงุฑูู
$account->total_incomes         // ุฅุฌูุงูู ุงูุฏุฎู
$account->calculated_balance    // ุงูุฑุตูุฏ ุงููุญุณูุจ
$account->balance              // ุงูุฑุตูุฏ ุงููุนูู
```

### ูู User Model:
```php
$user->cash_on_hand            // ุงูุณูููุฉ ุงูููุฏูุฉ
$user->accounts->sum('balance') // ุฅุฌูุงูู ุฃุฑุตุฏุฉ ุงูุญุณุงุจุงุช
```

### ูู Debt Model:
```php
Debt::getTotalPayable($userId)     // ุฅุฌูุงูู ุงูุฏููู ุนูู
Debt::getTotalReceivable($userId)  // ุฅุฌูุงูู ุงูุฏููู ูู
Debt::getOverdueCount($userId)     // ุนุฏุฏ ุงูุฏููู ุงููุชุฃุฎุฑุฉ
Debt::getDueSoon($userId)          // ุงูุฏููู ูุฑูุจุฉ ุงูุงุณุชุญูุงู
```

---

## ุงูุฃูุงู ูุงูุตูุงุญูุงุช

### Policies ุงููุทุจูุฉ:

1. **DebtPolicy:**
   - view: ุงููุณุชุฎุฏู ูููู ุงูุฏูู
   - update: ุงููุณุชุฎุฏู ูููู ุงูุฏูู
   - delete: ุงููุณุชุฎุฏู ูููู ุงูุฏูู

2. **ูู Controllers:**
   - ุฌููุน ุงูุนูููุงุช ุชุชุญูู ูู `user_id`
   - ูุง ูููู ุงููุตูู ูุจูุงูุงุช ูุณุชุฎุฏู ุขุฎุฑ

---

## ุงูุชูุงุฑูุฑ ุงููุชูุงููุฉ

ูููู ุงูุขู ุฅูุดุงุก ุชูุงุฑูุฑ ุดุงููุฉ ุชุฌูุน:

```php
// ุชูุฑูุฑ ุงููุถุน ุงููุงูู ุงููุงูู
$user = auth()->user();

$report = [
    'accounts' => [
        'total_balance' => $user->accounts->sum('balance'),
        'accounts_count' => $user->accounts->count(),
    ],
    'incomes' => [
        'total' => Income::where('user_id', $user->id)->sum('amount'),
        'this_month' => Income::getMonthTotal($user->id),
    ],
    'expenses' => [
        'total' => Expense::where('user_id', $user->id)->sum('amount'),
        'this_month' => Expense::getMonthTotal($user->id),
    ],
    'debts' => [
        'total_payable' => Debt::getTotalPayable($user->id),
        'total_receivable' => Debt::getTotalReceivable($user->id),
        'net_position' => Debt::getTotalReceivable($user->id) - Debt::getTotalPayable($user->id),
        'overdue_count' => Debt::getOverdueCount($user->id),
    ],
    'net_worth' => $user->cash_on_hand + Debt::getTotalReceivable($user->id) - Debt::getTotalPayable($user->id),
];
```

---

## ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ

โ **ุงูุชูุงูู ููุชูู 100%**

### ุฌููุน ุงูุฃูุธูุฉ ูุฑุจูุทุฉ:
- โ ุงูุญุณุงุจุงุช ุงููุงููุฉ ูู ุงููุฑูุฒ
- โ ุงููุตุงุฑูู ูุฑุจูุทุฉ ุจุงูุญุณุงุจุงุช
- โ ุงูุฏุฎู ูุฑุจูุท ุจุงูุญุณุงุจุงุช
- โ ุงูุฏููู ูุฑุจูุทุฉ ุจุงูุญุณุงุจุงุช
- โ ุฏูุนุงุช ุงูุฏููู ูุฑุจูุทุฉ ุจุงูุญุณุงุจุงุช

### ุงูุชุญุฏูุซุงุช ุงูุชููุงุฆูุฉ ุชุนูู:
- โ ุฑุตูุฏ ุงูุญุณุงุจ ูุชุญุฏุซ ุนูุฏ ุงููุตุฑูู
- โ ุฑุตูุฏ ุงูุญุณุงุจ ูุชุญุฏุซ ุนูุฏ ุงูุฏุฎู
- โ ุฑุตูุฏ ุงูุญุณุงุจ ูุชุญุฏุซ ุนูุฏ ุฏูุนุฉ ุงูุฏูู
- โ ุญุงูุฉ ุงูุฏูู ุชุชุญุฏุซ ุนูุฏ ุงูุฏูุน
- โ ุงูุนูููุงุช ุงูุนูุณูุฉ ุชุนูู (ุนูุฏ ุงูุญุฐู)

### ุงูุนูุงูุงุช ููุฌูุฏุฉ ูู ููุง ุงูุงุชุฌุงููู:
- โ Account โ Expenses, Incomes, Debts, DebtPayments
- โ Expense โ Account
- โ Income โ Account
- โ Debt โ Account, Payments
- โ DebtPayment โ Debt, Account
- โ User โ Accounts, Debts, PayableDebts, ReceivableDebts

### ุงูุฃูุงู ูุทุจู:
- โ Policies ููุฏููู
- โ ุงูุชุญูู ูู user_id ูู ุฌููุน ุงูุนูููุงุช
- โ ูุง ูููู ุงููุตูู ูุจูุงูุงุช ูุณุชุฎุฏู ุขุฎุฑ

**ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูุฌููุน ุงูุฃุฌุฒุงุก ุชุนูู ูุนุงู ุจุดูู ูุชูุงูู! ๐**
